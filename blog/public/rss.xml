<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Inquisitiveness]]></title><description><![CDATA[地方で生活している学生の日々勉強した内容や参加したイベント情報など]]></description><link>https://blog.ue-y.me</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 25 Mar 2020 17:26:49 GMT</lastBuildDate><item><title><![CDATA[Github actions+Gatsby.jsで最高のブログ環境を構築する]]></title><description><![CDATA[ブログを新しくしました。素晴らしくナウい構成だと思います。 ひたすら試行錯誤して慣れない環境でデプロイすることができました。 ブログを新しくした経緯については後で熱く語ります！ 構成 Gatsby.js (React Static Site Generator) Github…]]></description><link>https://blog.ue-y.me/myblog/</link><guid isPermaLink="false">https://blog.ue-y.me/myblog/</guid><pubDate>Sun, 22 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;ブログを新しくしました。素晴らしくナウい構成だと思います。&lt;br&gt;
ひたすら試行錯誤して慣れない環境でデプロイすることができました。&lt;br&gt;
ブログを新しくした経緯については後で熱く語ります！&lt;/p&gt;
&lt;h2&gt;構成&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Gatsby.js (React Static Site Generator)&lt;/li&gt;
&lt;li&gt;Github Actions (Build &amp;#x26; Deploy)&lt;/li&gt;
&lt;li&gt;Mixhost (Hosting Server)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Gatsby.js&lt;/h3&gt;
&lt;p&gt;Gatsby(ギャッツビー)？なにそれ？Man○om？って人用にざっくり説明すると、&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Reactというフレームワークで作られている&lt;br&gt;
Node.js パッケージが色々使える&lt;br&gt;
静的サイトジェネレータ&lt;br&gt;
表示が爆速&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;という特徴があります。&lt;/p&gt;
&lt;p&gt;以前はWordPressというPHPで作られたソフトウェアを利用しており、動的なブログだったため動作がモッサリしていましたが、今回は爆速です。&lt;/p&gt;
&lt;h3&gt;Github Actions&lt;/h3&gt;
&lt;p&gt;ビルド及びデプロイをGithub Actionsに統合しました。&lt;/p&gt;
&lt;p&gt;ActionsのWorkflowは以下のような手順で行っています。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Node.jsのセットアップ&lt;/li&gt;
&lt;li&gt;Gatsbyのビルド&lt;/li&gt;
&lt;li&gt;生成物(Artifact)のアップロード(一時保存)&lt;/li&gt;
&lt;li&gt;Artifactのダウンロード&lt;/li&gt;
&lt;li&gt;デプロイ先のサーバSSH Keyのインストール&lt;/li&gt;
&lt;li&gt;rsyncにてデプロイ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;これにより、Githubにpushすれば自動的にビルドしてデプロイを行ってくれます。非常に便利。&lt;/p&gt;
&lt;h2&gt;ハマったところ&lt;/h2&gt;
&lt;p&gt;Gatsby自体は以前利用した経験があったため詰まることはなかったですが、Github Actionsは初めての利用だったためかなり詰まりました。&lt;/p&gt;
&lt;p&gt;どのくらい詰まったかは、&lt;a href=&quot;https://github.com/psbss/yuu-blog/commits/develop&quot;&gt;コミットログ&lt;/a&gt;を見ていただければ分かるかと。&lt;/p&gt;
&lt;p&gt;中でも手順6のrsyncにてデプロイを行う部分はかなり手こずりました。&lt;br&gt;
rsync自体は非常に簡単で、&lt;/p&gt;
&lt;div class=&quot;gatsby-code-title&quot;&gt;bash&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 同期元ディレクトリ/ 同期先ディレクトリ/&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;と書けばいい感じに動いてくれます。これが、SSHを利用したrsyncになると、同期先サーバとディレクトリを指定します。ソースコードは以下の感じになります。&lt;/p&gt;
&lt;div class=&quot;gatsby-code-title&quot;&gt;bash&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 同期元ディレクトリ/ ユーザ名@ホストアドレス:同期先ディレクトリ/&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Github Actionsの場合は環境変数のようなsecretsという機能を利用することができるので、以下のように書き直せます。&lt;/p&gt;
&lt;div class=&quot;gatsby-code-title&quot;&gt;bash&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber NaN&quot; class=&quot;language-bash line-numbers&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; 同期元ディレクトリ/ &lt;span class=&quot;token variable&quot;&gt;${{secrets.REMOTE_USER}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;@&lt;span class=&quot;token variable&quot;&gt;${{secrets.REMOTE_HOST}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;:同期先ディレクトリ&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;このとき、REMOTE_HOST側のsecretsがうまく動かない場合があるので、そのときは直書する。&lt;/p&gt;</content:encoded></item></channel></rss>